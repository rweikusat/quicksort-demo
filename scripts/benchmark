#!/bin/sh
#
# run a standard benchmark for a sorting program
# and determine some statistics about comparions and swaps
#

PATH=/usr/local/bin:/bin:/usr/bin
export PATH

test "$TRACE" && set -x

ELEMS=16384
ITERS=4000

PRG="$1"

unset TTY
perl -e '-t(STDOUT) and exit 0; exit 1' && TTY=1

>tmp/cmps
>tmp/swaps

until test $ITERS = 0;
do
    test "$TTY" && {
        tput el1
        printf "\r%s" "$ITERS" >/dev/tty
    }

    out=$($PRG $(shuf -i 1-$ELEMS) | grep comparisons)
    cmps=`printf "%s" "$out" | cut -d' ' -f 2`
    swps=`printf "%s" "$out" | cut -d' ' -f 4`

    printf "%s\n" "$cmps" >>tmp/cmps
    printf "%s\n" "$swps" >>tmp/swaps

    ITERS=`expr $ITERS - 1`
done

test "$TTY" && {
    tput el1
    printf '\r'
}

printf "comparisons\n\n"
scripts/stats-from <tmp/cmps
printf "\nswaps\n\n"
scripts/stats-from <tmp/swaps
